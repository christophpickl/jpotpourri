<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" horizontalAlign="center" xmlns:view="net.sourceforge.jpotpourri.learnme.view.*">
	
	<mx:Script>
		<![CDATA[
			import logging.Logger;
			import net.sourceforge.jpotpourri.learnme.vo.ICheckedQuestion;
			import mx.events.ItemClickEvent;
			import net.sourceforge.jpotpourri.learnme.model.ModelLocator;
			import net.sourceforge.jpotpourri.learnme.vo.IQuestionary;
			
			private static const LOG:Logger = Logger.getLogger("QuestionaryPanel");
			
			private const model: ModelLocator = ModelLocator.instance;
			
			private function onButtonBarClick(event:ItemClickEvent):void {
				
	            var currentQuestion: ICheckedQuestion = model.currentQuestion;
	            const questionIndex: int = model.questionairy.checkedQuestions.getItemIndex(currentQuestion);
	            if(questionIndex == -1) {
	            	throw new Error("Could not get index of item: " + currentQuestion);
	            }
	            
	            var newQuestionIndex: int = -1;
		        if(event.label == "Prev") {
		        	if(questionIndex == 0) {
		        		LOG.finer("Prev disabled, because index == min");
		        	} else {
		        		newQuestionIndex = questionIndex - 1;
		        	}
		  		} else if(event.label == "Next") {
		  			if(questionIndex == (model.questionairy.checkedQuestions.length - 1)) {
		        		LOG.finer("Next disabled, because index == max");
		        	} else {
		        		newQuestionIndex = questionIndex + 1;
		        	}
		  		}
		  		
		  		if(newQuestionIndex != -1) {
		  			model.currentQuestion = ICheckedQuestion(model.questionairy.checkedQuestions.getItemAt(newQuestionIndex));
		  		}
			}
			
			private function doFinishQuestionairy(): void {
				
				parentApplication.currentState = "QuestionairyFinish";
			}
		]]>
	</mx:Script>
	
	
	<view:QuestionPanel width="100%" height="100%" />
	
	<mx:HBox width="100%" bottom="0">
		
		<mx:Button label="Abort Questionairy" click="parentApplication.currentState=''" />
		
		<mx:Spacer width="100%" />
		
		<mx:ButtonBar id="buttonBar" itemClick="onButtonBarClick(event)">
	        <mx:dataProvider>
	            <mx:Array>
	                <mx:Object label="Prev" />
	                <mx:Object label="Next" />
	            </mx:Array>
	        </mx:dataProvider>
	    </mx:ButtonBar>
	    
	    <mx:Label text="{model.questionairy.checkedQuestions.getItemIndex(model.currentQuestion) + 1} / {model.questionairy.checkedQuestions.length}" />
		
		<mx:Spacer width="100%" />
		
		<mx:Button label="Finish Questionairy" click="doFinishQuestionairy()" />
		
	</mx:HBox>
	
	
					
</mx:VBox>
